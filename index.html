
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Songliste</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f8f8f8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.5rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #007acc;
      color: white;
    }
    a {
      color: #007acc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Meine Songliste</h1>
  <div id="table-container">Wird geladen...</div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-FcZH5479jScVw7EiJZSYs9awnAUWoMEpKqnl1F1CY5TpjIAM4okD2ZVYwz4HoyJS7RItGz7u7pFP/pub?output=csv";

    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const rows = text.trim().split("\n").map(r => r.split(","));
      const headers = rows[0];
      return rows.slice(1).map(row => {
        const obj = Object.fromEntries(row.map((val, i) => [headers[i], val.trim()]));
        obj["Datensatznummer"] = obj["Datensatznummer"].trim(); // Wichtig!
        return obj;
      });
    }

    function buildTable(data) {
      const container = document.getElementById("table-container");
      if (data.length === 0) {
        container.innerHTML = "<p>Keine Daten gefunden.</p>";
        return;
      }

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      // Tabellenkopf
      const headerRow = document.createElement("tr");
      ["Song", "Interpret", "Sprache", "Können", "Kapo"].forEach(key => {
        const th = document.createElement("th");
        th.textContent = key;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      // Datenzeilen
      data.forEach(row => {
        const tr = document.createElement("tr");

        const songCell = document.createElement("td");
        const link = document.createElement("a");
        link.href = `song.html?id=${row["Datensatznummer"]}`;
        link.textContent = row["Song"];
        songCell.appendChild(link);
        tr.appendChild(songCell);

        ["Interpret", "Sprache", "Können (1-10)", "Kapo"].forEach(key => {
          const td = document.createElement("td");
          td.textContent = row[key] || "";
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      container.innerHTML = "";
      container.appendChild(table);
    }

    loadCSV(csvUrl)
      .then(buildTable)
      .catch(err => {
        console.error(err);
        document.getElementById("table-container").textContent = "Fehler beim Laden.";
      });
  </script>
</body>
</html>
